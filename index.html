<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <title>3000METER.com - Pace Calculator</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="pwa/manifest.json">
  <link rel="icon" type="image/svg+xml" href="assets/stadium.svg">
  
  <meta name="theme-color" content="#dc2626">
  <meta name="description" content="3000METER.com - Professional pace calculator for track athletes">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="loading">
    <!-- Calculation Loading Overlay -->
    <div id="calculationLoading" class="calculation-loading hidden">
      <div class="calculation-loading-content">
        <div class="calculation-spinner"></div>
        <p class="calculation-loading-text">Calculating...</p>
      </div>
    </div>

    <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-track">
        <svg viewBox="0 0 200 200" class="loading-track-svg">
          <defs>
            <filter id="loading-glow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <!-- Track -->
          <circle cx="100" cy="100" r="70" fill="none" stroke="currentColor" stroke-width="8" opacity="0.2"/>
          <circle cx="100" cy="100" r="70" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="5 5" opacity="0.4"/>
          <!-- Runner -->
          <g class="loading-runner">
            <circle cx="100" cy="30" r="8" fill="#dc2626" filter="url(#loading-glow)" class="loading-runner-circle"/>
          </g>
        </svg>
      </div>
      <h2 class="loading-title">3000METER.com</h2>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div class="app-container">
    <!-- Minimal Header -->
    <header class="header">
      <a href="https://3000meter.com/" class="header-title" onclick="window.location.replace('https://3000meter.com/'); return false;">3000METER.com</a>
      <button id="themeToggle" class="theme-btn" aria-label="Toggle theme">
        <i data-lucide="moon"></i>
      </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Race Setup - Simplified -->
      <section class="race-setup">
        <!-- Summary Card (shown after calculation) -->
        <div id="raceSummary" class="race-summary hidden">
          <div class="summary-content">
            <div class="summary-header">
              <h3 class="summary-title">Race Plan</h3>
              <button id="editBtn" class="edit-btn">
                <i data-lucide="edit"></i> Edit
              </button>
            </div>
            <div class="summary-grid">
              <div class="summary-item">
                <span class="summary-label">Distance</span>
                <span class="summary-value" id="summaryDistance">3000m</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Target Time</span>
                <span class="summary-value" id="summaryTime">15:00</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Target Pace</span>
                <span class="summary-value" id="summaryPace">05:00/km</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Strategy</span>
                <span class="summary-value" id="summaryStrategy">Even</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Track Type</span>
                <span class="summary-value" id="summaryTrackType">Outdoor</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Input Area (collapsible) -->
        <div id="inputArea" class="input-area">
          <div class="setup-grid-simple">
          <!-- Distance -->
          <div class="input-group-simple">
            <label>Distance</label>
            <div class="distance-input-wrapper">
              <input type="number" id="raceDistance" value="3000" min="100" step="any" class="distance-input">
              <span class="unit-label">m</span>
            </div>
            <div class="preset-buttons-compact">
              <div class="preset-group">
                <span class="preset-group-label">Olympic</span>
                <div class="preset-group-buttons">
                  <button type="button" class="preset-btn-compact" data-distance="100">100m</button>
                  <button type="button" class="preset-btn-compact" data-distance="200">200m</button>
                  <button type="button" class="preset-btn-compact" data-distance="400">400m</button>
                  <button type="button" class="preset-btn-compact" data-distance="800">800m</button>
                  <button type="button" class="preset-btn-compact" data-distance="1500">1500m</button>
                  <button type="button" class="preset-btn-compact active" data-distance="3000">3000m</button>
                  <button type="button" class="preset-btn-compact" data-distance="5000">5000m</button>
                  <button type="button" class="preset-btn-compact" data-distance="10000">10000m</button>
                </div>
              </div>
              <div class="preset-group">
                <span class="preset-group-label">Miles</span>
                <div class="preset-group-buttons">
                  <button type="button" class="preset-btn-compact" data-distance="1609">1 Mile</button>
                  <button type="button" class="preset-btn-compact" data-distance="3218">2 Miles</button>
                  <button type="button" class="preset-btn-compact" data-distance="4827">3 Miles</button>
                  <button type="button" class="preset-btn-compact" data-distance="8045">5 Miles</button>
                  <button type="button" class="preset-btn-compact" data-distance="16090">10 Miles</button>
                </div>
              </div>
              <div class="preset-group">
                <span class="preset-group-label">Road</span>
                <div class="preset-group-buttons">
                  <button type="button" class="preset-btn-compact" data-distance="21097">Half</button>
                  <button type="button" class="preset-btn-compact" data-distance="42195">Marathon</button>
                  <button type="button" class="preset-btn-compact" data-distance="100000">Ultra 100k</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Time / Pace Input -->
          <div class="input-group-simple">
            <label>Target Time</label>
            <input type="text" id="goalTime" value="13:00" placeholder="13:00" maxlength="7" class="time-input-simple">
            <div class="time-suggestions" id="timeSuggestions"></div>
            <div class="adjust-buttons">
              <button type="button" onclick="adjustTime(-10)">−10s</button>
              <button type="button" onclick="adjustTime(-5)">−5s</button>
              <button type="button" onclick="adjustTime(5)">+5s</button>
              <button type="button" onclick="adjustTime(10)">+10s</button>
            </div>
          </div>

          <!-- Pace Input -->
          <div class="input-group-simple">
            <label>Target Pace</label>
            <div class="pace-input-wrapper">
              <input type="text" id="targetPace" value="04:20" placeholder="04:20" maxlength="7" class="pace-input-simple">
              <span class="unit-label">/km</span>
            </div>
            <div class="adjust-buttons">
              <button type="button" onclick="adjustPace(-5)">−5s</button>
              <button type="button" onclick="adjustPace(-1)">−1s</button>
              <button type="button" onclick="adjustPace(1)">+1s</button>
              <button type="button" onclick="adjustPace(5)">+5s</button>
            </div>
          </div>

          <!-- Strategy -->
          <div class="input-group-simple">
            <label>Strategy</label>
            <div class="strategy-buttons-simple">
              <button class="strategy-btn-simple active" data-strategy="even">Even</button>
              <button class="strategy-btn-simple" data-strategy="neg10p">−10%</button>
              <button class="strategy-btn-simple" data-strategy="neg5p">−5%</button>
              <button class="strategy-btn-simple" data-strategy="neg3p">−3%</button>
              <button class="strategy-btn-simple" data-strategy="pos3p">+3%</button>
              <button class="strategy-btn-simple" data-strategy="pos5p">+5%</button>
              <button class="strategy-btn-simple" data-strategy="pos10p">+10%</button>
              <button class="strategy-btn-simple" data-strategy="kick600">Kick 600m</button>
              <button class="strategy-btn-simple" data-strategy="progressive">Progressive</button>
              <button class="strategy-btn-simple" data-strategy="degressive">Degressive</button>
              <button class="strategy-btn-simple" data-strategy="custom">Custom</button>
            </div>
            
            <!-- Advanced Options (Collapsible) -->
            <div id="advancedStrategyOptions" class="advanced-strategy-options" style="display: none;">
              <div class="strategy-controls">
                <div class="strategy-control">
                  <label>Progression Type</label>
                  <select id="progressionType" class="strategy-select">
                    <option value="linear">Linear</option>
                    <option value="exponential">Exponential</option>
                    <option value="sigmoid">Sigmoid</option>
                  </select>
                </div>
                <div class="strategy-control">
                  <label>Pace Change per 400m (seconds)</label>
                  <input type="number" id="paceChange" value="-2" step="0.1" class="strategy-input">
                </div>
                <div class="strategy-control">
                  <label>Start Pace</label>
                  <input type="text" id="startPace" value="05:00" placeholder="05:00" class="strategy-input">
                </div>
                <div class="strategy-control">
                  <label>End Pace</label>
                  <input type="text" id="endPace" value="05:00" placeholder="05:00" class="strategy-input">
                </div>
              </div>
            </div>
          </div>

          <!-- Track Type -->
          <div class="input-group-simple">
            <label>Track Type</label>
            <div class="track-type-buttons">
              <button type="button" class="track-type-btn active" data-track-type="outdoor">
                <i data-lucide="sun"></i> Outdoor
              </button>
              <button type="button" class="track-type-btn" data-track-type="indoor">
                <i data-lucide="building"></i> Indoor
              </button>
              <button type="button" class="track-type-btn" data-track-type="road">
                <i data-lucide="map-pin"></i> Road
              </button>
            </div>
          </div>

          <!-- Calculate Button -->
          <button id="calculateBtn" class="btn-calculate">Calculate</button>
          </div>
        </div>
      </section>

      <!-- Track Visualization -->
      <section class="track-section">
        <div class="track-container">
          <svg viewBox="0 0 1600 1000" role="img" aria-label="Track">
            <defs>
              <filter id="runner-glow">
                <feGaussianBlur stdDeviation="4" result="blur"/>
                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <pattern id="road-dash" x="0" y="0" width="40" height="6" patternUnits="userSpaceOnUse">
                <rect x="0" y="0" width="20" height="3" fill="#ffd700"/>
                <rect x="0" y="3" width="20" height="3" fill="none"/>
              </pattern>
            </defs>
            <rect x="0" y="0" width="1600" height="1000" fill="var(--track-bg)"/>
            <g id="background-elements"></g>
            <g id="stadium"></g>
            <g id="infield"></g>
            <g id="road-center-line"></g>
            <g id="track-base"></g>
            <g id="lane-boundaries" stroke="#ffffff" stroke-width="3"></g>
            <g id="markers"></g>
            <g id="lane-numbers"></g>
            <g id="runner">
              <circle id="runner-dot" r="12" fill="#007AFF" stroke="#ffffff" stroke-width="4" filter="url(#runner-glow)"/>
            </g>
            <g id="round-indicators"></g>
          </svg>
          
          <!-- Timing Board -->
          <div id="timingBoard" class="timing-board hidden">
            <div class="timing-board-content">
              <div class="timing-board-row">
                <span class="timing-label">TIME</span>
                <span id="timingTime" class="timing-value">00:00.00</span>
              </div>
              <div class="timing-board-row">
                <span class="timing-label">LAP</span>
                <span id="timingLap" class="timing-value">1</span>
              </div>
              <div class="timing-board-row">
                <span class="timing-label">DISTANCE</span>
                <span id="timingDistance" class="timing-value">0m</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Simple Controls -->
        <div class="track-controls-simple">
          <div class="control-group">
            <button id="playPauseBtn" class="control-btn">
              <i data-lucide="play"></i>
            </button>
            <button id="resetBtn" class="control-btn">
              <i data-lucide="rotate-cw"></i>
            </button>
          </div>
          <div class="speed-controls">
            <label class="speed-label">Speed:</label>
            <button id="speedDownBtn" class="speed-btn" title="Decrease speed">
              <i data-lucide="minus"></i>
            </button>
            <input type="range" id="speedSlider" min="0.1" max="100" step="0.1" value="1" class="speed-slider">
            <button id="speedUpBtn" class="speed-btn" title="Increase speed">
              <i data-lucide="plus"></i>
            </button>
            <input type="number" id="speedInput" min="0.1" max="100" step="0.1" value="1" class="speed-input" placeholder="1.0">
          </div>
          <div class="status-display">
            <div class="status-item-simple">
              <span class="status-label">Lap</span>
              <span id="currentLapDisplay">1</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Distance</span>
              <span id="currentDistanceDisplay">0m</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Pace</span>
              <span id="currentPaceDisplay">--:--</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Progress</span>
              <span id="progressPercentDisplay">0%</span>
            </div>
          </div>
          <div class="time-display">
            <span id="largeTargetTimeDisplay">00:00.00 / 15:00</span>
          </div>
        </div>
      </section>

      <!-- Results -->
      <section class="results-section">
        <!-- Download Buttons -->
        <div class="download-buttons-container">
          <button id="downloadStrategyBtn" class="download-strategy-btn">
            <i data-lucide="download"></i> Download Strategy
          </button>
          <button id="downloadStrategyPDFBtn" class="download-strategy-btn">
            <i data-lucide="file-text"></i> Download TXT
          </button>
        </div>
        
        <div class="results-tabs">
          <button class="tab-btn active" data-tab="splits">Splits</button>
          <button class="tab-btn" data-tab="chart">Chart</button>
        </div>

        <div id="splitsTab" class="tab-content active">
          <!-- Split Management Controls -->
          <div class="splits-controls">
            <div class="splits-presets">
              <label>Add Split:</label>
              <div class="split-preset-buttons">
                <!-- Split buttons will be dynamically generated based on distance -->
              </div>
            </div>
            <div class="splits-custom">
              <input type="number" id="customSplitDistance" placeholder="Custom distance (m)" min="50" step="50" class="custom-split-input">
              <button type="button" id="addCustomSplitBtn" class="add-split-btn">
                <i data-lucide="plus"></i> Add
              </button>
            </div>
          </div>
          
          <!-- Dynamic Splits Tables -->
          <div id="cumulativeTimesContainer" class="splits-container"></div>
        </div>

        <div id="chartTab" class="tab-content">
          <!-- Chart Type Selector -->
          <div class="chart-type-selector">
            <button class="chart-type-btn active" data-chart-type="pace">
              <i data-lucide="gauge"></i> Pace
            </button>
            <button class="chart-type-btn" data-chart-type="speed">
              <i data-lucide="zap"></i> Speed
            </button>
            <button class="chart-type-btn" data-chart-type="time">
              <i data-lucide="clock"></i> Time
            </button>
            <button class="chart-type-btn" data-chart-type="split-pace">
              <i data-lucide="activity"></i> Split Pace
            </button>
            <button class="chart-type-btn" data-chart-type="acceleration">
              <i data-lucide="trending-up"></i> Acceleration
            </button>
            <button class="chart-type-btn" data-chart-type="effort">
              <i data-lucide="target"></i> Effort Level
            </button>
          </div>
          
          <div class="chart-container">
            <canvas id="paceChart"></canvas>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <a href="https://3000meter.com/" class="footer-title" onclick="window.location.replace('https://3000meter.com/'); return false;">3000METER.com</a>
        <p class="footer-description">Professional pace calculator for track athletes. Plan your perfect race strategy with advanced pacing options and detailed visualizations.</p>
        <div class="footer-links">
          <a href="https://github.com/egil10/3000meter" target="_blank" rel="noopener noreferrer">
            <i data-lucide="github"></i> GitHub
          </a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/modules/state.js"></script>
  <script src="js/modules/track.js"></script>
  <script src="js/modules/pace-calculator.js"></script>
  <script src="js/modules/animation.js"></script>
  <script src="js/modules/ui.js"></script>
  <script src="js/modules/storage.js"></script>
  <script src="js/modules/main.js"></script>
  <script>
    // Initialize Lucide icons after DOM is loaded
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  </script>
</body>
</html>
