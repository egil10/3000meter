<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <title>3000METER.com - Pace Calculator</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="pwa/manifest.json">
  <link rel="icon" type="image/svg+xml" href="assets/stadium.svg">
  
  <meta name="theme-color" content="#dc2626">
  <meta name="description" content="3000METER.com - Professional pace calculator for track athletes">
  
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="loading">
    <!-- Calculation Loading Overlay -->
    <div id="calculationLoading" class="calculation-loading hidden">
      <div class="calculation-loading-content">
        <div class="calculation-spinner"></div>
        <p class="calculation-loading-text">Calculating...</p>
      </div>
    </div>

    <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-track">
        <svg viewBox="0 0 200 200" class="loading-track-svg">
          <defs>
            <filter id="loading-glow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <!-- Track -->
          <circle cx="100" cy="100" r="70" fill="none" stroke="currentColor" stroke-width="8" opacity="0.2"/>
          <circle cx="100" cy="100" r="70" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="5 5" opacity="0.4"/>
          <!-- Runner -->
          <g class="loading-runner">
            <circle cx="100" cy="30" r="8" fill="#dc2626" filter="url(#loading-glow)" class="loading-runner-circle"/>
          </g>
        </svg>
      </div>
      <h2 class="loading-title">3000METER.com</h2>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div class="app-container">
    <!-- Minimal Header -->
    <header class="header">
      <a href="https://3000meter.com/" class="header-title" onclick="window.location.replace('https://3000meter.com/'); return false;">3000METER.com</a>
      <div class="theme-selector">
        <button id="themeToggle" class="theme-btn" aria-label="Theme" aria-haspopup="true" aria-expanded="false">
          <span class="theme-icon-light">
            <i data-lucide="sun"></i>
          </span>
          <span class="theme-icon-dark">
            <i data-lucide="moon"></i>
          </span>
          <span class="theme-icon-system">
            <i data-lucide="monitor"></i>
          </span>
        </button>
        <div id="themeMenu" class="theme-menu hidden">
          <button class="theme-menu-item" data-theme="light">
            <i data-lucide="sun"></i>
            <span>Light</span>
          </button>
          <button class="theme-menu-item" data-theme="dark">
            <i data-lucide="moon"></i>
            <span>Dark</span>
          </button>
          <button class="theme-menu-item" data-theme="system">
            <i data-lucide="monitor"></i>
            <span>System</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Race Setup - Simplified -->
      <section class="race-setup">
        <!-- Summary Card (shown after calculation) -->
        <div id="raceSummary" class="race-summary hidden">
          <div class="summary-content">
            <div class="summary-header">
              <h3 class="summary-title">Race Plan</h3>
              <button id="editBtn" class="edit-btn">
                <i data-lucide="edit"></i> Edit
              </button>
            </div>
            <div class="summary-grid">
              <div class="summary-item">
                <span class="summary-label">Distance</span>
                <span class="summary-value" id="summaryDistance">3000m</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Target Time</span>
                <span class="summary-value" id="summaryTime">15:00</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Target Pace</span>
                <span class="summary-value" id="summaryPace">05:00/km</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Strategy</span>
                <span class="summary-value" id="summaryStrategy">Even</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Track Type</span>
                <span class="summary-value" id="summaryTrackType">Outdoor</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Input Area (collapsible) -->
        <div id="inputArea" class="input-area">
          <div class="setup-grid-new">
          <!-- Column 1: Distance -->
          <div class="input-group-new">
            <label>Distance</label>
            <div class="distance-input-wrapper">
              <input type="number" id="raceDistance" value="3000" min="100" step="any" class="distance-input">
              <span class="unit-label">m</span>
            </div>
            <div class="preset-buttons-compact">
              <span class="preset-group-label">Olympic</span>
              <button type="button" class="preset-btn-compact" data-distance="100">100m</button>
              <button type="button" class="preset-btn-compact" data-distance="200">200m</button>
              <button type="button" class="preset-btn-compact" data-distance="400">400m</button>
              <button type="button" class="preset-btn-compact" data-distance="800">800m</button>
              <button type="button" class="preset-btn-compact" data-distance="1500">1500m</button>
              <button type="button" class="preset-btn-compact active" data-distance="3000">3000m</button>
              <button type="button" class="preset-btn-compact" data-distance="5000">5000m</button>
              <button type="button" class="preset-btn-compact" data-distance="10000">10000m</button>
              <span class="preset-group-label">Miles</span>
              <button type="button" class="preset-btn-compact" data-distance="1609">1 Mile</button>
              <button type="button" class="preset-btn-compact" data-distance="3218">2 Miles</button>
              <button type="button" class="preset-btn-compact" data-distance="8045">5 Miles</button>
              <button type="button" class="preset-btn-compact" data-distance="16090">10 Miles</button>
              <span class="preset-group-label">Road</span>
              <button type="button" class="preset-btn-compact" data-distance="21097">Half</button>
              <button type="button" class="preset-btn-compact" data-distance="42195">Marathon</button>
              <button type="button" class="preset-btn-compact" data-distance="60000">Ultra 60k</button>
              <button type="button" class="preset-btn-compact" data-distance="100000">Ultra 100k</button>
            </div>
          </div>

          <!-- Column 2: Time / Pace Input (Stacked) -->
          <div class="input-group-new time-pace-stacked">
            <div class="time-pace-field">
              <label>Target Time</label>
              <input type="text" id="goalTime" value="13:00" placeholder="13:00" maxlength="7" class="time-input-simple">
              <div class="time-suggestions" id="timeSuggestions"></div>
              <div class="adjust-buttons">
                <button type="button" onclick="adjustTime(-10)">−10s</button>
                <button type="button" onclick="adjustTime(-5)">−5s</button>
                <button type="button" onclick="adjustTime(5)">+5s</button>
                <button type="button" onclick="adjustTime(10)">+10s</button>
              </div>
            </div>
            <div class="time-pace-field">
              <label>Target Pace</label>
              <div class="pace-input-wrapper">
                <input type="text" id="targetPace" value="04:20" placeholder="04:20" maxlength="7" class="pace-input-simple">
                <span class="unit-label">/km</span>
              </div>
              <div class="time-suggestions" id="paceSuggestions"></div>
              <div class="adjust-buttons">
                <button type="button" onclick="adjustPace(-5)">−5s</button>
                <button type="button" onclick="adjustPace(-1)">−1s</button>
                <button type="button" onclick="adjustPace(1)">+1s</button>
                <button type="button" onclick="adjustPace(5)">+5s</button>
              </div>
            </div>
            
            <button id="calculateBtn" class="btn-calculate">Run</button>
          </div>
          </div>
        </div>
      </section>

      <!-- Track Visualization -->
      <section class="track-section">
        <div class="track-container">
          <div class="track-visualization">
            <svg viewBox="0 0 1600 1000" role="img" aria-label="Track">
            <defs>
              <filter id="runner-glow">
                <feGaussianBlur stdDeviation="4" result="blur"/>
                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <pattern id="road-dash" x="0" y="0" width="40" height="6" patternUnits="userSpaceOnUse">
                <rect x="0" y="0" width="20" height="3" fill="#ffd700"/>
                <rect x="0" y="3" width="20" height="3" fill="none"/>
              </pattern>
            </defs>
            <rect x="0" y="0" width="1600" height="1000" fill="var(--track-bg)"/>
            <g id="background-elements"></g>
            <g id="stadium"></g>
            <g id="infield"></g>
            <g id="road-center-line"></g>
            <g id="track-base"></g>
            <g id="lane-boundaries" stroke="#ffffff" stroke-width="3"></g>
            <g id="markers"></g>
            <g id="lane-numbers"></g>
            <g id="runner">
              <circle id="runner-dot" r="12" fill="#007AFF" stroke="#ffffff" stroke-width="4" filter="url(#runner-glow)"/>
            </g>
            <g id="round-indicators">            </g>
          </svg>
          
          <!-- Timing Board -->
          <div id="timingBoard" class="timing-board hidden">
            <div class="timing-board-content">
              <div class="timing-board-row">
                <span class="timing-label">TIME</span>
                <span id="timingTime" class="timing-value">00:00.00</span>
              </div>
              <div class="timing-board-row">
                <span class="timing-label">LAP</span>
                <span id="timingLap" class="timing-value">1</span>
              </div>
              <div class="timing-board-row">
                <span class="timing-label">DISTANCE</span>
                <span id="timingDistance" class="timing-value">0m</span>
              </div>
            </div>
          </div>
          </div>

          <!-- Simple Controls -->
          <div class="track-controls-simple">
          <div class="track-type-controls">
            <label class="track-type-label">Track Type</label>
            <div class="track-type-buttons">
              <button type="button" class="track-type-btn active" data-track-type="outdoor">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="sun" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> Outdoor
              </button>
              <button type="button" class="track-type-btn" data-track-type="indoor">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="building" class="lucide lucide-building"><path d="M12 10h.01"></path><path d="M12 14h.01"></path><path d="M12 6h.01"></path><path d="M16 10h.01"></path><path d="M16 14h.01"></path><path d="M16 6h.01"></path><path d="M8 10h.01"></path><path d="M8 14h.01"></path><path d="M8 6h.01"></path><path d="M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"></path><rect x="4" y="2" width="16" height="20" rx="2"></rect></svg> Indoor
              </button>
              <button type="button" class="track-type-btn" data-track-type="road">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="map-pin" class="lucide lucide-map-pin"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg> Road
              </button>
            </div>
          </div>
          <div class="control-group">
            <button id="playPauseBtn" class="control-btn">
              <i data-lucide="play"></i>
            </button>
            <button id="resetBtn" class="control-btn">
              <i data-lucide="rotate-cw"></i>
            </button>
          </div>
          <div class="speed-controls">
            <label class="speed-label">Speed:</label>
            <div class="speed-buttons">
              <button type="button" class="speed-preset-btn active" data-speed="1">1x</button>
              <button type="button" class="speed-preset-btn" data-speed="2">2x</button>
              <button type="button" class="speed-preset-btn" data-speed="3">3x</button>
              <button type="button" class="speed-preset-btn" data-speed="4">4x</button>
              <button type="button" class="speed-preset-btn" data-speed="5">5x</button>
              <button type="button" class="speed-preset-btn" data-speed="10">10x</button>
              <button type="button" class="speed-preset-btn" data-speed="20">20x</button>
              <button type="button" class="speed-preset-btn" data-speed="30">30x</button>
              <button type="button" class="speed-preset-btn" data-speed="40">40x</button>
              <button type="button" class="speed-preset-btn" data-speed="50">50x</button>
              <button type="button" class="speed-preset-btn" data-speed="100">100x</button>
            </div>
          </div>
          <div class="status-display">
            <div class="status-item-simple">
              <span class="status-label">Lap</span>
              <span id="currentLapDisplay">1</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Distance</span>
              <span id="currentDistanceDisplay">0m</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Pace</span>
              <span id="currentPaceDisplay">--:--</span>
            </div>
            <div class="status-item-simple">
              <span class="status-label">Progress</span>
              <span id="progressPercentDisplay">0%</span>
            </div>
          </div>
          <div class="time-display">
            <span id="largeTargetTimeDisplay">00:00.00 / 15:00</span>
          </div>
          </div>
        </div>
      </section>

      <!-- Results -->
      <section class="results-section">
        <!-- Download Buttons -->
        <div class="download-buttons-container">
          <button id="downloadStrategyBtn" class="download-strategy-btn">
            <i data-lucide="download"></i> Download Strategy
          </button>
          <button id="downloadStrategyPDFBtn" class="download-strategy-btn">
            <i data-lucide="file-text"></i> Download TXT
          </button>
        </div>

        <div id="splitsTab" class="tab-content active">
          <div class="splits-layout">
            <!-- Left Side: Controls -->
            <div class="splits-controls">
              <div class="splits-presets">
                <label>Add Split:</label>
                <div class="split-preset-buttons">
                  <!-- Split buttons will be dynamically generated based on distance -->
                </div>
              </div>
              <div class="splits-custom">
                <input type="number" id="customSplitDistance" placeholder="Custom distance (m)" min="1" step="1" class="custom-split-input">
                <button type="button" id="addCustomSplitBtn" class="add-split-btn">
                  <i data-lucide="plus"></i> Add
                </button>
              </div>
              <button type="button" id="clearAllSplitsBtn" class="btn-clear-all">
                <i data-lucide="trash-2"></i> Clear All
              </button>
            </div>
            
            <!-- Right Side: Split Tables Grid -->
            <div id="cumulativeTimesContainer" class="splits-grid"></div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <a href="https://3000meter.com/" class="footer-title" onclick="window.location.replace('https://3000meter.com/'); return false;">3000METER.com</a>
        <p class="footer-description">Professional pace calculator for track athletes. Plan your perfect race strategy with advanced pacing options and detailed visualizations.</p>
        <div class="footer-links">
          <a href="https://github.com/egil10/3000meter" target="_blank" rel="noopener noreferrer">
            <i data-lucide="github"></i> GitHub
          </a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/modules/state.js"></script>
  <script src="js/modules/track.js"></script>
  <script src="js/modules/pace-calculator.js"></script>
  <script src="js/modules/animation.js"></script>
  <script src="js/modules/ui.js"></script>
  <script src="js/modules/storage.js"></script>
  <script src="js/modules/main.js"></script>
  <script>
    // Initialize Lucide icons after DOM is loaded
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  </script>
</body>
</html>
