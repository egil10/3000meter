<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3K Pace Calculator - Professional Running Tool</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="Professional 3K pace calculator with lane-aware splits and advanced pacing strategies">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#dc2626">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-running"></i> 3K Pace Calculator</h1>
                <div class="header-controls">
                    <button id="languageToggle" class="lang-btn" title="Switch to English">
                        <i class="fas fa-globe"></i> NO
                    </button>
                    <button id="proModeToggle" class="pro-btn" title="Pro Athlete Mode">
                        <i class="fas fa-user-shield"></i>
                    </button>
                    <button id="shareBtn" class="share-btn" title="Copy Share Link">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <main class="main-layout">
            <!-- Left Panel: Controls & Splits -->
            <div class="left-panel">
                <!-- Input Section -->
                <section class="input-section">
                    <div class="input-card">
                        <h2>Target Settings</h2>
                        
                        <!-- Goal Time Input -->
                        <div class="input-group">
                            <label for="goalTime">Goal Time (mm:ss or mm:ss.s)</label>
                            <div class="time-input-wrapper">
                                <input type="text" id="goalTime" placeholder="09:30" value="09:30">
                                <div class="time-controls">
                                    <button class="time-btn" data-adjust="-5" title="Shift+Click: -5s">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="-1" title="Shift+Click: -5s">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="1" title="Shift+Click: +5s">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="5" title="Shift+Click: +5s">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Lane Selection -->
                        <div class="input-group">
                            <label for="laneSelect">Track Lane</label>
                            <select id="laneSelect">
                                <option value="1">Lane 1 (400m)</option>
                                <option value="2">Lane 2 (407.04m)</option>
                                <option value="3">Lane 3 (414.08m)</option>
                                <option value="4">Lane 4 (421.12m)</option>
                                <option value="5">Lane 5 (428.16m)</option>
                                <option value="6">Lane 6 (435.20m)</option>
                                <option value="7">Lane 7 (442.24m)</option>
                                <option value="8">Lane 8 (449.28m)</option>
                            </select>
                        </div>

                        <!-- Pace Strategy Presets -->
                        <div class="input-group">
                            <label>Pace Strategy</label>
                            <div class="strategy-buttons">
                                <button class="strategy-btn active" data-strategy="even">
                                    <i class="fas fa-equals"></i> Even
                                </button>
                                <button class="strategy-btn" data-strategy="neg1">
                                    <i class="fas fa-arrow-down"></i> -1%
                                </button>
                                <button class="strategy-btn" data-strategy="neg2">
                                    <i class="fas fa-arrow-down"></i> -2.5%
                                </button>
                                <button class="strategy-btn" data-strategy="custom">
                                    <i class="fas fa-sliders-h"></i> Custom
                                </button>
                            </div>
                        </div>

                        <!-- Progressive Pace Tool -->
                        <div id="progressiveSection" class="input-group" style="display: none;">
                            <label>Progressive Pace</label>
                            <div class="progressive-inputs">
                                <div class="pace-input">
                                    <label for="startPace">Start Pace (min/km)</label>
                                    <input type="text" id="startPace" placeholder="3:30">
                                </div>
                                <div class="pace-input">
                                    <label for="endPace">End Pace (min/km)</label>
                                    <input type="text" id="endPace" placeholder="3:20">
                                </div>
                                <div class="curve-select">
                                    <label for="curveType">Curve Type</label>
                                    <select id="curveType">
                                        <option value="linear">Linear</option>
                                        <option value="exponential">Exponential</option>
                                        <option value="sigmoidal">Sigmoidal</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Surge Designer -->
                        <div class="input-group">
                            <label>Surge Designer</label>
                            <div class="surge-controls">
                                <button id="addSurgeBtn" class="surge-btn">
                                    <i class="fas fa-plus"></i> Add Surge
                                </button>
                                <div id="surgeList" class="surge-list">
                                    <!-- Surges will be added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Coach Notes -->
                        <div class="input-group">
                            <label for="coachNotes">Coach Notes</label>
                            <textarea id="coachNotes" placeholder="Add notes for your pace band..." rows="2"></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button id="calculateBtn" class="calculate-btn">
                                <i class="fas fa-calculator"></i> Calculate
                            </button>
                            <button id="printBtn" class="print-btn">
                                <i class="fas fa-print"></i> Print Pace Band
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Results Section -->
                <section class="results-section">
                    <div class="results-card">
                        <h3>Overall Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric">
                                <span class="metric-label">Target Time</span>
                                <span id="targetTimeDisplay" class="metric-value">--:--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Pace/km</span>
                                <span id="overallPace" class="metric-value">--:--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Speed</span>
                                <span id="avgSpeed" class="metric-value">-- km/h</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Laps</span>
                                <span id="lapCount" class="metric-value">7.5</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Split Times -->
                <section class="splits-section">
                    <div class="splits-card">
                        <h3>Split Times</h3>
                        <div class="splits-tabs">
                            <button class="tab-btn active" data-distance="100">100m</button>
                            <button class="tab-btn" data-distance="200">200m</button>
                            <button class="tab-btn" data-distance="400">400m</button>
                            <button class="tab-btn" data-distance="1000">1000m</button>
                        </div>
                        <div class="splits-content">
                            <div id="splitsTable" class="splits-table">
                                <!-- Split times will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel: Track & Charts -->
            <div class="right-panel">
                <!-- Track Visualization -->
                <section class="track-section">
                    <div class="track-card">
                        <h3>Track Visualization</h3>
                        <div id="trackContainer">
                            <img id="trackImage" src="field.svg" style="width: 100%; height: 100%; object-fit: contain;">
                            <svg id="overlaySVG" width="800" height="600" style="position: absolute; top: 0; left: 0; pointer-events: none;">
                                <g id="runnerGroup">
                                    <circle id="runnerTrail" cx="0" cy="0" r="8" class="runner-trail"/>
                                    <circle id="runner" cx="0" cy="0" r="5" class="runner"/>
                                </g>
                                <g id="roundIndicators"></g>
                            </svg>
                            <div id="lapProgressBar">
                                <div id="lapProgressFill"></div>
                            </div>
                            <div id="animationControls">
                                <button id="playPauseBtn"><i class="fas fa-play"></i></button>
                                <button id="resetBtn"><i class="fas fa-redo"></i></button>
                                <button id="speedBtn"><i class="fas fa-tachometer-alt"></i> 1x</button>
                                <span id="speedDisplay">1x Speed</span>
                            </div>
                            <div id="animationInfo">
                                <p>Lap: <span id="currentLap">0</span></p>
                                <p>Distance: <span id="currentDistance">0m</span></p>
                                <p>Time: <span id="currentTime">--:--</span></p>
                                <p>Progress: <span id="progressPercent">0%</span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="charts-card">
                        <h3>Pace Analysis</h3>
                        <div class="chart-controls">
                            <button id="toggleCharts" class="chart-btn">
                                <i class="fas fa-chart-line"></i> Show Charts
                            </button>
                        </div>
                        <div id="chartsContainer" class="charts-container" style="display: none;">
                            <div class="chart-wrapper">
                                <canvas id="paceChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="deltaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 3K Pace Calculator. Built for runners, by runners.</p>
            <div class="footer-links">
                <button id="offlineToggle" class="footer-btn">
                    <i class="fas fa-wifi"></i> <span id="offlineStatus">Online</span>
                </button>
                <button id="restoreSession" class="footer-btn">
                    <i class="fas fa-history"></i> Restore Session
                </button>
            </div>
        </footer>
    </div>

    <!-- Surge Modal -->
    <div id="surgeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Add Surge</h3>
            <div class="surge-form">
                <div class="form-group">
                    <label for="surgeStart">Start Distance (m)</label>
                    <input type="number" id="surgeStart" min="0" max="3000" step="100">
                </div>
                <div class="form-group">
                    <label for="surgeEnd">End Distance (m)</label>
                    <input type="number" id="surgeEnd" min="0" max="3000" step="100">
                </div>
                <div class="form-group">
                    <label for="surgePace">Pace Adjustment (s/km)</label>
                    <input type="number" id="surgePace" step="0.1" placeholder="-5.0">
                </div>
            </div>
            <div class="modal-actions">
                <button id="saveSurge" class="btn-primary">Save Surge</button>
                <button id="cancelSurge" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
