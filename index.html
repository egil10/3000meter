<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3k Run Tracker - Pace Calculator</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles and manifest -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="pwa/manifest.json">
  <link rel="icon" type="image/svg+xml" href="assets/stadium.svg">
  
  <!-- Meta tags -->
  <meta name="theme-color" content="#dc2626">
  <meta name="description" content="3k track running pace calculator with animated runner visualization">
  <meta property="og:title" content="3k Run Tracker â€“ Pace Calculator">
  <meta property="og:description" content="Plan perfect 3K pacing with lane-aware splits, surges, and live track animation.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/stadium.svg">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>
          <img src="assets/stadium.svg" alt="Stadium" width="24" height="24">
          <span data-i18n="title">3k Run Tracker</span>
        </h1>
        <div class="header-controls">
          <button id="languageToggle" class="lang-btn" title="Switch language">
            <i class="fas fa-globe"></i> EN
          </button>
        </div>
      </div>
    </header>

    <!-- Track Visualization - Main Centerpiece -->
    <section class="track-section">
      <div class="track-container">
        <div class="track-layout">
          <div class="track-wrap">
            <svg viewBox="0 0 1600 1000" role="img" aria-label="3000m oval track with eight lanes and animated runner">
              <defs>
                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="8" result="blur"/>
                  <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
                <filter id="runner-glow" x="-100%" y="-100%" width="300%" height="300%">
                  <feGaussianBlur stdDeviation="4" result="blur"/>
                  <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
              </defs>

              <!-- Background -->
              <rect x="0" y="0" width="1600" height="1000" fill="#f8fafc"/>

              <!-- Stadium apron (grey ring around the track) -->
              <g id="stadium"></g>

              <!-- Infield (inside inner boundary) -->
              <g id="infield"></g>

              <!-- Track base: red lanes as a continuous band -->
              <g id="track-base" stroke-linecap="round" stroke-linejoin="round"></g>

              <!-- White lane boundary lines (including inner & outer edges) -->
              <g id="lane-boundaries" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></g>

              <!-- Distance & start lines across all lanes -->
              <g id="markers"></g>

              <!-- Lane numbers at start line -->
              <g id="lane-numbers"></g>

              <!-- Runner -->
              <g id="runner" class="runner-shadow">
                <circle id="runner-dot" r="12" fill="#007AFF" stroke="#ffffff" stroke-width="4" filter="url(#runner-glow)"/>
              </g>

              <!-- Round indicators -->
              <g id="round-indicators"></g>
            </svg>
          </div>

          <!-- Track controls panel -->
          <div class="track-controls-panel">
            <!-- Target Time Display with Animation Controls -->
            <div class="target-time-display">
              <div class="target-time-label" data-i18n="target_time">Target Time</div>
              <div class="target-time-controls">
                <div class="animation-controls">
                  <button id="playPauseBtn" class="anim-btn" title="Play/Pause" aria-label="Play/Pause">
                    <i class="fas fa-play"></i>
                  </button>
                  <button id="resetBtn" class="anim-btn" title="Reset" aria-label="Reset">
                    <i class="fas fa-undo"></i>
                  </button>
                </div>
                <div class="target-time-value" id="largeTargetTimeDisplay">00:00.00 / 09:30</div>
              </div>
            </div>

            <!-- Current Status Grid - 1 row, 4 columns -->
            <div class="current-status-grid">
              <div class="status-item">
                <span class="status-label" data-i18n="lap">Lap</span>
                <span class="status-value" id="currentLapDisplay">1</span>
              </div>
              <div class="status-item">
                <span class="status-label" data-i18n="distance">Distance</span>
                <span class="status-value" id="currentDistanceDisplay">0m</span>
              </div>
              <div class="status-item">
                <span class="status-label" data-i18n="progress">Progress</span>
                <span class="status-value" id="progressPercentDisplay">0%</span>
              </div>
              <div class="status-item">
                <span class="status-label" data-i18n="pace">Pace</span>
                <span class="status-value" id="currentPaceDisplay">--:--</span>
              </div>
            </div>

            <!-- Speed controls -->
            <div class="speed-controls">
              <div class="speed-slider-container">
                <label for="speedSlider" class="speed-label">Speed</label>
                <div class="speed-input-group">
                                  <input type="range" id="speedSlider" min="1" max="10" step="1" value="1" class="speed-slider">
                <button class="speed-btn" id="speedMinusBtn">-</button>
                <input type="number" id="speedInput" min="1" max="10" step="1" value="1" class="speed-input" readonly>
                  <button class="speed-btn" id="speedPlusBtn">+</button>
                </div>
              </div>
            </div>

            <!-- Lap progress bar -->
            <div class="lap-progress-container">
              <div class="lap-progress-bar">
                <div class="lap-progress-fill" id="lapProgressFill"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Race Setup Section - Wide bar below track section -->
    <section class="race-setup-section">
      <div class="race-setup-container">
        <h3 data-i18n="race_setup">Race Setup</h3>

        <div class="input-group">
          <label for="goalTime" data-i18n="target_time">Target Time (mm:ss)</label>
          <div class="time-input-wrapper">
            <input type="text" id="goalTime" value="09:30" placeholder="09:30" maxlength="7" pattern="^\d{1,2}:\d{2}(\.\d{1,2})?$">
            <div class="time-controls">
              <button class="time-btn" data-adjust="1" title="+1s" aria-label="Add 1 second">+1</button>
              <button class="time-btn" data-adjust="5" title="+5s" aria-label="Add 5 seconds">+5</button>
              <button class="time-btn" data-adjust="-1" title="-1s" aria-label="Subtract 1 second">-1</button>
              <button class="time-btn" data-adjust="-5" title="-5s" aria-label="Subtract 5 seconds">-5</button>
            </div>
          </div>
          <div class="input-helper" id="timeHelper"></div>
        </div>

        <div class="input-group">
          <label for="targetPace" data-i18n="target_pace">Target Pace (mm:ss/km)</label>
          <div class="time-input-wrapper">
            <input type="text" id="targetPace" value="03:10" placeholder="03:10" maxlength="7" pattern="^\d{1,2}:\d{2}(\.\d{1,2})?$">
            <div class="time-controls">
              <button class="time-btn" data-adjust="1" title="+1s" aria-label="Add 1 second">+1</button>
              <button class="time-btn" data-adjust="5" title="+5s" aria-label="Add 5 seconds">+5</button>
              <button class="time-btn" data-adjust="-1" title="-1s" aria-label="Subtract 1 second">-1</button>
              <button class="time-btn" data-adjust="-5" title="-5s" aria-label="Subtract 5 seconds">-5</button>
            </div>
          </div>
          <div class="input-helper" id="paceHelper"></div>
        </div>



        <div class="input-group">
          <label data-i18n="pacing_strategy">Pacing Strategy</label>
          <div class="strategy-buttons">
            <button class="strategy-btn active" data-strategy="even">
              <i class="fas fa-equals"></i> <span data-i18n="even">Even</span>
            </button>
            <button class="strategy-btn" data-strategy="neg2">
              <i class="fas fa-arrow-down"></i> <span data-i18n="neg2">-2s/400m</span>
            </button>
            <button class="strategy-btn" data-strategy="neg1">
              <i class="fas fa-arrow-down"></i> <span data-i18n="neg1">-1s/400m</span>
            </button>
            <button class="strategy-btn" data-strategy="pos1">
              <i class="fas fa-arrow-up"></i> <span data-i18n="pos1">+1s/400m</span>
            </button>
            <button class="strategy-btn" data-strategy="kick600">
              <i class="fas fa-bolt"></i> <span data-i18n="kick600">Kick 600m</span>
            </button>
            <button class="strategy-btn" data-strategy="custom">
              <i class="fas fa-sliders-h"></i> <span data-i18n="custom">Custom</span>
            </button>
          </div>
        </div>

        <div id="progressiveSection" class="input-group" style="display: none;">
          <div class="progressive-inputs">
            <div>
              <label for="startPace" data-i18n="start_pace">Start Pace (mm:ss/km)</label>
              <input type="text" id="startPace" value="03:10" placeholder="03:10">
            </div>
            <div>
              <label for="endPace" data-i18n="end_pace">End Pace (mm:ss/km)</label>
              <input type="text" id="endPace" value="03:00" placeholder="03:00">
            </div>
            <div class="curve-select">
              <label for="curveType" data-i18n="progression_type">Progression Type</label>
              <select id="curveType">
                <option value="linear" data-i18n="linear">Linear</option>
                <option value="exponential" data-i18n="exponential">Exponential</option>
                <option value="sigmoidal" data-i18n="sigmoidal">Sigmoidal</option>
              </select>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label data-i18n="surge_designer">Surge Designer</label>
          <button id="addSurgeBtn" class="surge-btn">
            <i class="fas fa-plus"></i> <span data-i18n="add_surge">Add Surge</span>
          </button>
          <div id="surgeList" class="surge-list"></div>
        </div>

        <div class="action-buttons">
          <button id="calculateBtn" class="calculate-btn">
            <i class="fas fa-calculator"></i> <span data-i18n="calculate">Calculate</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Analytics Panel -->
      <div class="analytics-panel">

        <!-- Charts Card -->
        <div class="charts-card">
          <h3 data-i18n="analytics">Analytics</h3>
          <div class="chart-controls">
            <button id="toggleCharts" class="chart-btn">
              <i class="fas fa-chart-line"></i> <span data-i18n="show_charts">Show Charts</span>
            </button>
          </div>
          <div id="chartsContainer" class="charts-container" style="display: none;">
            <div class="chart-wrapper">
              <canvas id="paceChart"></canvas>
            </div>
            <div class="chart-wrapper">
              <canvas id="deltaChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p data-i18n="footer_text">3000m Track Runner - Professional pace calculator for track athletes</p>
    </footer>
  </div>

  <!-- Surge Modal -->
  <div id="surgeModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 data-i18n="add_surge">Add Surge</h3>
      <form class="surge-form">
        <div class="form-group">
          <label for="surgeStart" data-i18n="surge_start">Start Distance (m)</label>
          <input type="number" id="surgeStart" min="0" max="3000" step="50">
        </div>
        <div class="form-group">
          <label for="surgeEnd" data-i18n="surge_end">End Distance (m)</label>
          <input type="number" id="surgeEnd" min="0" max="3000" step="50">
        </div>
        <div class="form-group">
          <label for="surgePace" data-i18n="surge_pace">Pace Adjustment (s/km)</label>
          <input type="number" id="surgePace" step="0.1" placeholder="e.g., -5 for faster">
        </div>
      </form>
      <div class="modal-actions">
        <button id="cancelSurge" class="btn-secondary" data-i18n="cancel">Cancel</button>
        <button id="saveSurge" class="btn-primary" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js" defer></script>
  <script src="js/script.js" defer></script>
</body>
</html>
