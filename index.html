<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3K Pace Calculator - Professional Running Tool</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="Professional 3K pace calculator with lane-aware splits and advanced pacing strategies">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#dc2626">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-running"></i> 3K Pace Calculator</h1>
                <div class="header-controls">
                    <button id="languageToggle" class="lang-btn" title="Switch to English">
                        <i class="fas fa-globe"></i> NO
                    </button>
                    <button id="proModeToggle" class="pro-btn" title="Pro Athlete Mode">
                        <i class="fas fa-user-shield"></i>
                    </button>
                    <button id="shareBtn" class="share-btn" title="Copy Share Link">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <main class="main-layout">
            <!-- Left Panel: Controls & Splits -->
            <div class="left-panel">
                <!-- Input Section -->
                <section class="input-section">
                    <div class="input-card">
                        <h2>Target Settings</h2>
                        
                        <!-- Goal Time Input -->
                        <div class="input-group">
                            <label for="goalTime">Goal Time (mm:ss or mm:ss.s)</label>
                            <div class="time-input-wrapper">
                                <input type="text" id="goalTime" placeholder="09:30" value="09:30">
                                <div class="time-controls">
                                    <button class="time-btn" data-adjust="-5" title="Shift+Click: -5s">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="-1" title="Shift+Click: -5s">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="1" title="Shift+Click: +5s">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <button class="time-btn" data-adjust="5" title="Shift+Click: +5s">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Lane Selection -->
                        <div class="input-group">
                            <label for="laneSelect">Track Lane</label>
                            <select id="laneSelect">
                                <option value="1">Lane 1 (400m)</option>
                                <option value="2">Lane 2 (407.04m)</option>
                                <option value="3">Lane 3 (414.08m)</option>
                                <option value="4">Lane 4 (421.12m)</option>
                                <option value="5">Lane 5 (428.16m)</option>
                                <option value="6">Lane 6 (435.20m)</option>
                                <option value="7">Lane 7 (442.24m)</option>
                                <option value="8">Lane 8 (449.28m)</option>
                            </select>
                        </div>

                        <!-- Pace Strategy Presets -->
                        <div class="input-group">
                            <label>Pace Strategy</label>
                            <div class="strategy-buttons">
                                <button class="strategy-btn active" data-strategy="even">
                                    <i class="fas fa-equals"></i> Even
                                </button>
                                <button class="strategy-btn" data-strategy="neg1">
                                    <i class="fas fa-arrow-down"></i> -1%
                                </button>
                                <button class="strategy-btn" data-strategy="neg2">
                                    <i class="fas fa-arrow-down"></i> -2.5%
                                </button>
                                <button class="strategy-btn" data-strategy="custom">
                                    <i class="fas fa-sliders-h"></i> Custom
                                </button>
                            </div>
                        </div>

                        <!-- Progressive Pace Tool -->
                        <div id="progressiveSection" class="input-group" style="display: none;">
                            <label>Progressive Pace</label>
                            <div class="progressive-inputs">
                                <div class="pace-input">
                                    <label for="startPace">Start Pace (min/km)</label>
                                    <input type="text" id="startPace" placeholder="3:30">
                                </div>
                                <div class="pace-input">
                                    <label for="endPace">End Pace (min/km)</label>
                                    <input type="text" id="endPace" placeholder="3:20">
                                </div>
                                <div class="curve-select">
                                    <label for="curveType">Curve Type</label>
                                    <select id="curveType">
                                        <option value="linear">Linear</option>
                                        <option value="exponential">Exponential</option>
                                        <option value="sigmoidal">Sigmoidal</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Surge Designer -->
                        <div class="input-group">
                            <label>Surge Designer</label>
                            <div class="surge-controls">
                                <button id="addSurgeBtn" class="surge-btn">
                                    <i class="fas fa-plus"></i> Add Surge
                                </button>
                                <div id="surgeList" class="surge-list">
                                    <!-- Surges will be added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Coach Notes -->
                        <div class="input-group">
                            <label for="coachNotes">Coach Notes</label>
                            <textarea id="coachNotes" placeholder="Add notes for your pace band..." rows="2"></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button id="calculateBtn" class="calculate-btn">
                                <i class="fas fa-calculator"></i> Calculate
                            </button>
                            <button id="printBtn" class="print-btn">
                                <i class="fas fa-print"></i> Print Pace Band
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Results Section -->
                <section class="results-section">
                    <div class="results-card">
                        <h3>Overall Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric">
                                <span class="metric-label">Target Time</span>
                                <span id="targetTimeDisplay" class="metric-value">--:--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Pace/km</span>
                                <span id="overallPace" class="metric-value">--:--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Speed</span>
                                <span id="avgSpeed" class="metric-value">-- km/h</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Laps</span>
                                <span id="lapCount" class="metric-value">7.5</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Split Times -->
                <section class="splits-section">
                    <div class="splits-card">
                        <h3>Split Times</h3>
                        <div class="splits-tabs">
                            <button class="tab-btn active" data-distance="100">100m</button>
                            <button class="tab-btn" data-distance="200">200m</button>
                            <button class="tab-btn" data-distance="400">400m</button>
                            <button class="tab-btn" data-distance="1000">1000m</button>
                        </div>
                        <div class="splits-content">
                            <div id="splitsTable" class="splits-table">
                                <!-- Split times will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel: Track & Charts -->
            <div class="right-panel">
                <!-- Track Visualization -->
                <section class="track-section">
                    <div class="track-card">
                        <h3>Track Visualization</h3>
                        <div class="track-container">
                            <!-- Stadium Backdrop -->
                            <div class="stadium-backdrop">
                                <img src="stadium.svg" alt="Stadium" class="stadium-image">
                                <div class="stadium-overlay"></div>
                            </div>
                            
                            <!-- Track SVG with Runner -->
                            <svg id="trackSVG" class="track-svg" viewBox="0 0 800 600">
                                <!-- Stadium backdrop will be positioned behind -->
                                <defs>
                                    <filter id="glow">
                                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                        <feMerge> 
                                            <feMergeNode in="coloredBlur"/>
                                            <feMergeNode in="SourceGraphic"/>
                                        </feMerge>
                                    </filter>
                                    <filter id="shadow">
                                        <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.3)"/>
                                    </filter>
                                </defs>
                                
                                <!-- Track will be drawn here -->
                                <g id="trackGroup"></g>
                                
                                <!-- Runner Animation -->
                                <g id="runnerGroup">
                                    <circle id="runner" cx="400" cy="300" r="8" fill="#dc2626" filter="url(#glow)">
                                        <animate id="runnerAnimation" attributeName="opacity" values="1;0.7;1" dur="1s" repeatCount="indefinite"/>
                                    </circle>
                                    <circle id="runnerTrail" cx="400" cy="300" r="4" fill="#fecaca" opacity="0.6">
                                        <animate attributeName="opacity" values="0.6;0.2;0.6" dur="0.8s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <!-- Round Indicators -->
                                <g id="roundIndicators"></g>
                                
                                <!-- Lap Progress Bar -->
                                <rect id="lapProgressBar" x="50" y="550" width="700" height="8" rx="4" fill="#e5e5e5" opacity="0.3"/>
                                <rect id="lapProgressFill" x="50" y="550" width="0" height="8" rx="4" fill="#dc2626"/>
                            </svg>
                            
                            <!-- Enhanced Track Overlay -->
                            <div class="track-overlay">
                                <div class="track-info">
                                    <div class="info-item">
                                        <span class="info-label">Current Lap:</span>
                                        <span id="currentLap" class="info-value">0</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Distance:</span>
                                        <span id="currentDistance" class="info-value">0m</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Time:</span>
                                        <span id="currentTime" class="info-value">--:--</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Progress:</span>
                                        <span id="progressPercent" class="info-value">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Round Display -->
                                <div class="round-display">
                                    <div class="round-title">Rounds</div>
                                    <div id="roundList" class="round-list">
                                        <!-- Rounds will be generated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Animation Controls -->
                            <div class="animation-controls">
                                <button id="playPauseBtn" class="anim-btn" title="Play/Pause Animation">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button id="resetBtn" class="anim-btn" title="Reset Animation">
                                    <i class="fas fa-undo"></i>
                                </button>
                                <button id="speedBtn" class="anim-btn" title="Change Speed">
                                    <i class="fas fa-tachometer-alt"></i> 1x
                                </button>
                            </div>
                            
                            <!-- Speed Indicator -->
                            <div class="speed-indicator">
                                <span id="speedDisplay">1x Speed</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="charts-card">
                        <h3>Pace Analysis</h3>
                        <div class="chart-controls">
                            <button id="toggleCharts" class="chart-btn">
                                <i class="fas fa-chart-line"></i> Show Charts
                            </button>
                        </div>
                        <div id="chartsContainer" class="charts-container" style="display: none;">
                            <div class="chart-wrapper">
                                <canvas id="paceChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="deltaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 3K Pace Calculator. Built for runners, by runners.</p>
            <div class="footer-links">
                <button id="offlineToggle" class="footer-btn">
                    <i class="fas fa-wifi"></i> <span id="offlineStatus">Online</span>
                </button>
                <button id="restoreSession" class="footer-btn">
                    <i class="fas fa-history"></i> Restore Session
                </button>
            </div>
        </footer>
    </div>

    <!-- Surge Modal -->
    <div id="surgeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Add Surge</h3>
            <div class="surge-form">
                <div class="form-group">
                    <label for="surgeStart">Start Distance (m)</label>
                    <input type="number" id="surgeStart" min="0" max="3000" step="100">
                </div>
                <div class="form-group">
                    <label for="surgeEnd">End Distance (m)</label>
                    <input type="number" id="surgeEnd" min="0" max="3000" step="100">
                </div>
                <div class="form-group">
                    <label for="surgePace">Pace Adjustment (s/km)</label>
                    <input type="number" id="surgePace" step="0.1" placeholder="-5.0">
                </div>
            </div>
            <div class="modal-actions">
                <button id="saveSurge" class="btn-primary">Save Surge</button>
                <button id="cancelSurge" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
