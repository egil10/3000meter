<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3000m Track Runner - Pace Calculator</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles and manifest -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="pwa/manifest.json">
  <link rel="icon" type="image/svg+xml" href="assets/stadium.svg">
  
  <!-- Meta tags -->
  <meta name="theme-color" content="#dc2626">
  <meta name="description" content="3000m track running pace calculator with animated runner visualization">
  <meta property="og:title" content="3000m Track Runner â€“ Pace Calculator">
  <meta property="og:description" content="Plan perfect 3K pacing with lane-aware splits, surges, and live track animation.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/stadium.svg">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 2v20M2 12h20"/>
          </svg>
          <span data-i18n="title">3000m Track Runner</span>
        </h1>
        <div class="header-controls">
          <span id="offlineToggle" class="status-pill" aria-live="polite">Online</span>
          <button id="languageToggle" class="lang-btn" title="Switch language">
            <i class="fas fa-globe"></i> EN
          </button>
          <button id="proModeToggle" class="pro-btn" title="Toggle Pro Mode">
            <i class="fas fa-crown"></i> Pro
          </button>
          <button id="shareBtn" class="share-btn" title="Share" aria-label="Share">
            <i class="fas fa-share"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Track Visualization - Main Centerpiece -->
    <section class="track-section">
      <div class="track-container">
        <div class="track-wrap">
          <svg viewBox="0 0 1200 800" role="img" aria-label="3000m oval track with eight lanes and animated runner">
            <defs>
              <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="8" result="blur"/>
                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
              <filter id="runner-glow" x="-100%" y="-100%" width="300%" height="300%">
                <feGaussianBlur stdDeviation="4" result="blur"/>
                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
              </filter>
            </defs>

            <!-- Background -->
            <rect x="0" y="0" width="1200" height="800" fill="#f8fafc"/>

            <!-- Stadium apron (grey ring around the track) -->
            <g id="stadium"></g>

            <!-- Infield (inside inner boundary) -->
            <g id="infield"></g>

            <!-- Track base: red lanes as a continuous band -->
            <g id="track-base" stroke-linecap="round" stroke-linejoin="round"></g>

            <!-- White lane boundary lines (including inner & outer edges) -->
            <g id="lane-boundaries" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></g>

            <!-- Distance & start lines across all lanes -->
            <g id="markers"></g>

            <!-- Lane numbers at start line -->
            <g id="lane-numbers"></g>

            <!-- Runner -->
            <g id="runner" class="runner-shadow">
              <circle id="runner-dot" r="12" fill="#007AFF" stroke="#ffffff" stroke-width="4" filter="url(#runner-glow)"/>
            </g>

            <!-- Round indicators -->
            <g id="round-indicators"></g>

            <!-- Lap progress bar -->
            <g id="lap-progress">
              <rect x="50" y="750" width="700" height="8" fill="#e5e7eb" rx="4"/>
              <rect id="lap-progress-fill" x="50" y="750" width="0" height="8" fill="#007AFF" rx="4"/>
            </g>
          </svg>
        </div>

        <!-- Track overlay with info -->
        <div class="track-overlay" aria-live="polite">
          <div class="track-info">
            <div class="info-item">
              <span class="info-label" data-i18n="lap">Lap</span>
              <span class="info-value" id="currentLap">1</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-i18n="distance">Distance</span>
              <span class="info-value" id="currentDistance">0m</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-i18n="time">Time</span>
              <span class="info-value" id="currentTime">00:00</span>
            </div>
            <div class="info-item">
              <span class="info-label" data-i18n="progress">Progress</span>
              <span class="info-value" id="progressPercent">0%</span>
            </div>
          </div>
          <div class="round-display">
            <div class="round-title" data-i18n="rounds">Rounds</div>
            <div id="roundList" class="round-list"></div>
          </div>
        </div>

        <!-- Animation controls -->
        <div class="animation-controls">
          <button id="playPauseBtn" class="anim-btn" title="Play/Pause" aria-label="Play/Pause">
            <i class="fas fa-play"></i>
          </button>
          <button id="resetBtn" class="anim-btn" title="Reset" aria-label="Reset">
            <i class="fas fa-undo"></i>
          </button>
          <button id="speedBtn" class="anim-btn" title="Change Speed" aria-label="Change Speed">
            <i class="fas fa-tachometer-alt"></i>
          </button>
        </div>

        <!-- Speed indicator -->
        <div class="speed-indicator" id="speedDisplay">1x Speed</div>
        
        <!-- Mobile setup button -->
        <button id="setupBtn" class="setup-btn" title="Setup" aria-label="Setup">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Left Panel -->
      <div class="left-panel">
        <!-- Input Card -->
        <div class="input-card">
          <h2 data-i18n="race_setup">Race Setup</h2>

          <div class="input-group">
            <label for="goalTime" data-i18n="target_time">Target Time (mm:ss)</label>
            <div class="time-input-wrapper">
              <input type="text" id="goalTime" value="09:30" placeholder="09:30" maxlength="7" pattern="^\d{1,2}:\d{2}(\.\d{1,2})?$">
              <div class="time-controls">
                <button class="time-btn" data-adjust="1" title="+1s" aria-label="Add 1 second">+1</button>
                <button class="time-btn" data-adjust="5" title="+5s" aria-label="Add 5 seconds">+5</button>
                <button class="time-btn" data-adjust="-1" title="-1s" aria-label="Subtract 1 second">-1</button>
                <button class="time-btn" data-adjust="-5" title="-5s" aria-label="Subtract 5 seconds">-5</button>
              </div>
            </div>
            <div class="input-helper" id="timeHelper"></div>
          </div>

          <div class="input-group">
            <label for="laneSelect" data-i18n="lane">Lane</label>
            <select id="laneSelect">
              <option value="1">Lane 1 (400m)</option>
              <option value="2">Lane 2 (407m)</option>
              <option value="3">Lane 3 (414m)</option>
              <option value="4">Lane 4 (421m)</option>
              <option value="5">Lane 5 (428m)</option>
              <option value="6">Lane 6 (435m)</option>
              <option value="7">Lane 7 (442m)</option>
              <option value="8">Lane 8 (449m)</option>
            </select>
          </div>

          <div class="input-group">
            <label data-i18n="pacing_strategy">Pacing Strategy</label>
            <div class="strategy-buttons">
              <button class="strategy-btn active" data-strategy="even">
                <i class="fas fa-equals"></i> <span data-i18n="even">Even</span>
              </button>
              <button class="strategy-btn" data-strategy="neg1">
                <i class="fas fa-arrow-down"></i> <span data-i18n="neg1">Neg 1%</span>
              </button>
              <button class="strategy-btn" data-strategy="neg2">
                <i class="fas fa-arrow-down"></i> <span data-i18n="neg2">Neg 2.5%</span>
              </button>
              <button class="strategy-btn" data-strategy="pos1">
                <i class="fas fa-arrow-up"></i> <span data-i18n="pos1">Pos 1%</span>
              </button>
              <button class="strategy-btn" data-strategy="kick600">
                <i class="fas fa-bolt"></i> <span data-i18n="kick600">Kick 600m</span>
              </button>
              <button class="strategy-btn" data-strategy="custom">
                <i class="fas fa-sliders-h"></i> <span data-i18n="custom">Custom</span>
              </button>
            </div>
          </div>

          <div id="progressiveSection" class="input-group" style="display: none;">
            <div class="progressive-inputs">
              <div>
                <label for="startPace" data-i18n="start_pace">Start Pace (mm:ss/km)</label>
                <input type="text" id="startPace" value="03:10" placeholder="03:10">
              </div>
              <div>
                <label for="endPace" data-i18n="end_pace">End Pace (mm:ss/km)</label>
                <input type="text" id="endPace" value="03:00" placeholder="03:00">
              </div>
              <div class="curve-select">
                <label for="curveType" data-i18n="progression_type">Progression Type</label>
                <select id="curveType">
                  <option value="linear" data-i18n="linear">Linear</option>
                  <option value="exponential" data-i18n="exponential">Exponential</option>
                  <option value="sigmoidal" data-i18n="sigmoidal">Sigmoidal</option>
                </select>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label data-i18n="surge_designer">Surge Designer</label>
            <button id="addSurgeBtn" class="surge-btn">
              <i class="fas fa-plus"></i> <span data-i18n="add_surge">Add Surge</span>
            </button>
            <div id="surgeList" class="surge-list"></div>
          </div>

          <div class="action-buttons">
            <button id="calculateBtn" class="calculate-btn">
              <i class="fas fa-calculator"></i> <span data-i18n="calculate">Calculate</span>
            </button>
            <button id="printBtn" class="print-btn">
              <i class="fas fa-print"></i> <span data-i18n="print">Print</span>
            </button>
          </div>
        </div>

        <!-- Results Card -->
        <div class="results-card">
          <h3 data-i18n="results">Results</h3>
          <div class="metrics-grid">
            <div class="metric">
              <span class="metric-label" data-i18n="target_time">Target Time</span>
              <span class="metric-value" id="targetTimeDisplay">09:30</span>
            </div>
            <div class="metric">
              <span class="metric-label" data-i18n="overall_pace">Overall Pace</span>
              <span class="metric-value" id="overallPace">03:10</span>
            </div>
            <div class="metric">
              <span class="metric-label" data-i18n="avg_speed">Avg Speed</span>
              <span class="metric-value" id="avgSpeed">18.9 km/h</span>
            </div>
            <div class="metric">
              <span class="metric-label" data-i18n="laps">Laps</span>
              <span class="metric-value" id="lapCount">7.5</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="right-panel">
        <!-- Splits Card -->
        <div class="splits-card">
          <h3 data-i18n="splits">Splits</h3>
          <div class="splits-tabs">
            <button class="tab-btn active" data-distance="100">100m</button>
            <button class="tab-btn" data-distance="200">200m</button>
            <button class="tab-btn" data-distance="400">400m</button>
            <button class="tab-btn" data-distance="1000">1000m</button>
          </div>
          <div id="splitsTable" class="splits-table" aria-live="polite"></div>
          <div class="splits-actions">
            <button id="copyCsvBtn" class="csv-btn">
              <i class="fas fa-copy"></i> <span data-i18n="copy_csv">Copy CSV</span>
            </button>
            <button id="downloadCsvBtn" class="csv-btn">
              <i class="fas fa-download"></i> <span data-i18n="download_csv">Download CSV</span>
            </button>
          </div>
        </div>

        <!-- Charts Card -->
        <div class="charts-card">
          <h3 data-i18n="analytics">Analytics</h3>
          <div class="chart-controls">
            <button id="toggleCharts" class="chart-btn">
              <i class="fas fa-chart-line"></i> <span data-i18n="show_charts">Show Charts</span>
            </button>
          </div>
          <div id="chartsContainer" class="charts-container" style="display: none;">
            <div class="chart-wrapper">
              <canvas id="paceChart"></canvas>
            </div>
            <div class="chart-wrapper">
              <canvas id="deltaChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p data-i18n="footer_text">3000m Track Runner - Professional pace calculator for track athletes</p>
      <div class="footer-links">
        <button class="footer-btn" onclick="restoreSession()">
          <i class="fas fa-history"></i> <span data-i18n="restore_session">Restore Session</span>
        </button>
        <button class="footer-btn" onclick="window.print()">
          <i class="fas fa-print"></i> <span data-i18n="print">Print</span>
        </button>
      </div>
    </footer>
  </div>

  <!-- Surge Modal -->
  <div id="surgeModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 data-i18n="add_surge">Add Surge</h3>
      <form class="surge-form">
        <div class="form-group">
          <label for="surgeStart" data-i18n="surge_start">Start Distance (m)</label>
          <input type="number" id="surgeStart" min="0" max="3000" step="50">
        </div>
        <div class="form-group">
          <label for="surgeEnd" data-i18n="surge_end">End Distance (m)</label>
          <input type="number" id="surgeEnd" min="0" max="3000" step="50">
        </div>
        <div class="form-group">
          <label for="surgePace" data-i18n="surge_pace">Pace Adjustment (s/km)</label>
          <input type="number" id="surgePace" step="0.1" placeholder="e.g., -5 for faster">
        </div>
      </form>
      <div class="modal-actions">
        <button id="cancelSurge" class="btn-secondary" data-i18n="cancel">Cancel</button>
        <button id="saveSurge" class="btn-primary" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js" defer></script>
  <script src="js/script.js"></script>
</body>
</html>
